# Theme System Guide

Hidearea Design Systemã®åŒ…æ‹¬çš„ãªãƒ†ãƒ¼ãƒã‚·ã‚¹ãƒ†ãƒ ã‚¬ã‚¤ãƒ‰ã€‚ãƒ©ã‚¤ãƒˆãƒ»ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã€ã‚«ã‚¹ã‚¿ãƒ ãƒ†ãƒ¼ãƒã®ä½œæˆã€ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆã®å®Ÿè£…æ–¹æ³•ã‚’è§£èª¬ã—ã¾ã™ã€‚

## ç›®æ¬¡

- [æ¦‚è¦](#æ¦‚è¦)
- [ãƒ†ãƒ¼ãƒã®ä»•çµ„ã¿](#ãƒ†ãƒ¼ãƒã®ä»•çµ„ã¿)
- [åŸºæœ¬çš„ãªä½¿ã„æ–¹](#åŸºæœ¬çš„ãªä½¿ã„æ–¹)
- [ãƒ‡ã‚¶ã‚¤ãƒ³ãƒˆãƒ¼ã‚¯ãƒ³ã¨ãƒ†ãƒ¼ãƒ](#ãƒ‡ã‚¶ã‚¤ãƒ³ãƒˆãƒ¼ã‚¯ãƒ³ã¨ãƒ†ãƒ¼ãƒ)
- [ãƒ†ãƒ¼ãƒã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º](#ãƒ†ãƒ¼ãƒã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º)
- [ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆã®å®Ÿè£…](#ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆã®å®Ÿè£…)
- [é«˜åº¦ãªä½¿ç”¨æ–¹æ³•](#é«˜åº¦ãªä½¿ç”¨æ–¹æ³•)
- [ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹](#ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹)
- [ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](#ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)

## æ¦‚è¦

Hidearea Design Systemã¯ã€å®Œå…¨ãªãƒ†ãƒ¼ãƒã‚µãƒãƒ¼ãƒˆã‚’æä¾›ã—ã¾ã™ï¼š

- **ãƒ©ã‚¤ãƒˆãƒ»ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰**: 2ã¤ã®çµ„ã¿è¾¼ã¿ãƒ†ãƒ¼ãƒ
- **ã‚·ã‚¹ãƒ†ãƒ è¨­å®šé€£å‹•**: OSã®ãƒ†ãƒ¼ãƒè¨­å®šã«è‡ªå‹•è¿½å¾“
- **ã‚¹ãƒ ãƒ¼ã‚ºãªåˆ‡ã‚Šæ›¿ãˆ**: ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä»˜ããƒ†ãƒ¼ãƒé·ç§»
- **æ°¸ç¶šåŒ–**: LocalStorageã«ã‚ˆã‚‹ãƒ†ãƒ¼ãƒè¨­å®šã®ä¿å­˜
- **ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½**: ç‹¬è‡ªã®ãƒ†ãƒ¼ãƒã‚’ç°¡å˜ã«ä½œæˆ
- **ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£**: WCAG AAæº–æ‹ ã®ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆæ¯”

## ãƒ†ãƒ¼ãƒã®ä»•çµ„ã¿

### ãƒ†ãƒ¼ãƒã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

ãƒ†ãƒ¼ãƒã‚·ã‚¹ãƒ†ãƒ ã¯3å±¤æ§‹é€ ã§æ§‹æˆã•ã‚Œã¦ã„ã¾ã™ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. ãƒ™ãƒ¼ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³                    â”‚
â”‚  (colors, spacing, typography)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒˆãƒ¼ã‚¯ãƒ³              â”‚
â”‚  (component-*, surface-*, text-*)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. ãƒ†ãƒ¼ãƒãƒãƒªã‚¢ãƒ³ãƒˆ                   â”‚
â”‚  (light, dark)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒ†ãƒ¼ãƒãƒˆãƒ¼ã‚¯ãƒ³ã®å®šç¾©

å„ãƒ†ãƒ¼ãƒã¯ã€`data-theme`å±æ€§ã‚’ä½¿ç”¨ã—ã¦ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä¸Šæ›¸ãã—ã¾ã™ï¼š

```css
/* ãƒ©ã‚¤ãƒˆãƒ†ãƒ¼ãƒ */
[data-theme="light"] {
  --component-button-primary-background-default: #3B82F6;
  --component-button-primary-background-hover: #2563EB;
  --surface-base-background: #FFFFFF;
  --text-body-default-color: #171717;
}

/* ãƒ€ãƒ¼ã‚¯ãƒ†ãƒ¼ãƒ */
[data-theme="dark"] {
  --component-button-primary-background-default: #2563EB;
  --component-button-primary-background-hover: #1D4ED8;
  --surface-base-background: #171717;
  --text-body-default-color: #FAFAFA;
}
```

### ãƒ†ãƒ¼ãƒã®æ¤œå‡ºé †åº

1. **LocalStorageã®è¨­å®š**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ˜ç¤ºçš„ã«é¸æŠã—ãŸãƒ†ãƒ¼ãƒ
2. **ã‚·ã‚¹ãƒ†ãƒ è¨­å®š**: `prefers-color-scheme`ãƒ¡ãƒ‡ã‚£ã‚¢ã‚¯ã‚¨ãƒª
3. **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ**: ãƒ©ã‚¤ãƒˆãƒ†ãƒ¼ãƒ

## åŸºæœ¬çš„ãªä½¿ã„æ–¹

### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
npm install @hidearea-design/core @hidearea-design/tokens
```

### æœ€å°é™ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```html
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="node_modules/@hidearea-design/tokens/css/variables.css">
</head>
<body>
  <script type="module">
    import { initTheme } from '@hidearea-design/core/utils/theme';

    // ãƒ†ãƒ¼ãƒã‚·ã‚¹ãƒ†ãƒ ã‚’åˆæœŸåŒ–
    initTheme();
  </script>
</body>
</html>
```

### JavaScriptã§ã®ãƒ†ãƒ¼ãƒæ“ä½œ

```javascript
import {
  initTheme,
  getTheme,
  setTheme,
  toggleTheme,
  getEffectiveTheme,
  onThemeChange
} from '@hidearea-design/core/utils/theme';

// 1. åˆæœŸåŒ–ï¼ˆãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«1å›ã ã‘ï¼‰
initTheme();

// 2. ç¾åœ¨ã®ãƒ†ãƒ¼ãƒã‚’å–å¾—
const current = getTheme(); // 'light' | 'dark' | 'auto'

// 3. å®Ÿéš›ã«é©ç”¨ã•ã‚Œã¦ã„ã‚‹ãƒ†ãƒ¼ãƒã‚’å–å¾—
const effective = getEffectiveTheme(); // 'light' | 'dark'

// 4. ãƒ†ãƒ¼ãƒã‚’è¨­å®š
setTheme('dark');   // ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰
setTheme('light');  // ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰
setTheme('auto');   // ã‚·ã‚¹ãƒ†ãƒ è¨­å®šã«å¾“ã†

// 5. ãƒ©ã‚¤ãƒˆâ‡”ãƒ€ãƒ¼ã‚¯ã‚’ãƒˆã‚°ãƒ«
toggleTheme();

// 6. ãƒ†ãƒ¼ãƒå¤‰æ›´ã‚’ç›£è¦–
const unsubscribe = onThemeChange((theme) => {
  console.log('Theme changed to:', theme);
});

// ç›£è¦–ã‚’è§£é™¤
unsubscribe();
```

## ãƒ‡ã‚¶ã‚¤ãƒ³ãƒˆãƒ¼ã‚¯ãƒ³ã¨ãƒ†ãƒ¼ãƒ

### ãƒˆãƒ¼ã‚¯ãƒ³ã‚«ãƒ†ã‚´ãƒª

ãƒ†ãƒ¼ãƒã‚·ã‚¹ãƒ†ãƒ ã§ä½¿ç”¨ã•ã‚Œã‚‹ä¸»ãªãƒˆãƒ¼ã‚¯ãƒ³ã‚«ãƒ†ã‚´ãƒªï¼š

#### 1. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒˆãƒ¼ã‚¯ãƒ³

ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå›ºæœ‰ã®ã‚¹ã‚¿ã‚¤ãƒ«å®šç¾©ï¼š

```css
/* Button */
--component-button-primary-background-default
--component-button-primary-background-hover
--component-button-primary-background-active
--component-button-primary-text-default
--component-button-primary-border-default

/* Input */
--component-input-background-default
--component-input-background-disabled
--component-input-text-default
--component-input-text-placeholder
--component-input-border-default
--component-input-border-hover
--component-input-border-focus

/* Card */
--component-card-background-default
--component-card-background-hover
--component-card-background-selected
--component-card-border-default
```

#### 2. ã‚µãƒ¼ãƒ•ã‚§ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³

èƒŒæ™¯ã‚„éšå±¤ã‚’è¡¨ç¾ï¼š

```css
/* Base surfaces */
--surface-base-background
--surface-base-foreground
--surface-base-border

/* Raised surfaces (cards, modals) */
--surface-raised-background
--surface-raised-foreground
--surface-raised-border
--surface-raised-elevation

/* Overlay surfaces (modals, drawers) */
--surface-overlay-background
--surface-overlay-foreground
--surface-overlay-scrim
```

#### 3. ãƒ†ã‚­ã‚¹ãƒˆãƒˆãƒ¼ã‚¯ãƒ³

ã‚¿ã‚¤ãƒã‚°ãƒ©ãƒ•ã‚£ã¨ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆï¼š

```css
/* Body text */
--text-body-default-color
--text-body-muted-color
--text-body-subtle-color

/* Headings */
--text-heading-default-color
--text-heading-muted-color

/* UI text */
--text-label-default-color
--text-caption-default-color
--text-helper-default-color

/* Links */
--text-link-default-color
--text-link-hover-color
--text-link-visited-color
```

#### 4. çŠ¶æ…‹ãƒˆãƒ¼ã‚¯ãƒ³

ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³çŠ¶æ…‹ï¼š

```css
/* Focus */
--state-focus-ring-color
--state-focus-ring-width
--state-focus-ring-offset

/* Hover */
--state-hover-elevation-low
--state-hover-elevation-medium
--state-hover-elevation-high

/* Disabled */
--state-disabled-opacity
--state-disabled-cursor

/* Loading */
--state-loading-overlay-background
--state-loading-spinner-color
```

### ãƒ†ãƒ¼ãƒåˆ¥ãƒˆãƒ¼ã‚¯ãƒ³å€¤

#### ãƒ©ã‚¤ãƒˆãƒ†ãƒ¼ãƒã®ä¸»è¦ãƒˆãƒ¼ã‚¯ãƒ³

```css
[data-theme="light"] {
  /* Surfaces */
  --surface-base-background: #FFFFFF;
  --surface-base-foreground: #171717;
  --surface-base-border: #E5E5E5;

  --surface-raised-background: #FFFFFF;
  --surface-raised-elevation: 0 1px 3px 0 rgba(0, 0, 0, 0.1);

  --surface-overlay-background: #FFFFFF;
  --surface-overlay-scrim: rgba(0, 0, 0, 0.5);

  /* Text */
  --text-body-default-color: #171717;
  --text-body-muted-color: #525252;
  --text-body-subtle-color: #737373;

  /* Components */
  --component-button-primary-background-default: #3B82F6;
  --component-input-background-default: #FFFFFF;
  --component-input-border-default: #D4D4D4;
  --component-card-background-default: #FFFFFF;

  /* States */
  --state-focus-ring-color: #3B82F6;
  --state-hover-elevation-medium: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
}
```

#### ãƒ€ãƒ¼ã‚¯ãƒ†ãƒ¼ãƒã®ä¸»è¦ãƒˆãƒ¼ã‚¯ãƒ³

```css
[data-theme="dark"] {
  /* Surfaces */
  --surface-base-background: #171717;
  --surface-base-foreground: #FAFAFA;
  --surface-base-border: #404040;

  --surface-raised-background: #262626;
  --surface-raised-elevation: 0 1px 3px 0 rgba(0, 0, 0, 0.3);

  --surface-overlay-background: #262626;
  --surface-overlay-scrim: rgba(0, 0, 0, 0.75);

  /* Text */
  --text-body-default-color: #FAFAFA;
  --text-body-muted-color: #A3A3A3;
  --text-body-subtle-color: #737373;

  /* Components */
  --component-button-primary-background-default: #2563EB;
  --component-input-background-default: #262626;
  --component-input-border-default: #525252;
  --component-card-background-default: #262626;

  /* States */
  --state-focus-ring-color: #60A5FA;
  --state-hover-elevation-medium: 0 4px 6px -1px rgba(0, 0, 0, 0.5);
}
```

## ãƒ†ãƒ¼ãƒã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

### æ–¹æ³•1: CSSå¤‰æ•°ã®ä¸Šæ›¸ã

æ—¢å­˜ã®ãƒ†ãƒ¼ãƒã‚’ãƒ™ãƒ¼ã‚¹ã«ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºï¼š

```css
/* custom-theme.css */
[data-theme="light"] {
  /* ãƒ–ãƒ©ãƒ³ãƒ‰ã‚«ãƒ©ãƒ¼ã«å¤‰æ›´ */
  --component-button-primary-background-default: #8B5CF6;
  --component-button-primary-background-hover: #7C3AED;
  --state-focus-ring-color: #8B5CF6;

  /* ã‚µãƒ¼ãƒ•ã‚§ã‚¹ã‚’èª¿æ•´ */
  --surface-base-background: #F9FAFB;
  --surface-raised-background: #FFFFFF;
}

[data-theme="dark"] {
  --component-button-primary-background-default: #A78BFA;
  --component-button-primary-background-hover: #8B5CF6;
  --state-focus-ring-color: #A78BFA;

  --surface-base-background: #111827;
  --surface-raised-background: #1F2937;
}
```

### æ–¹æ³•2: ã‚«ã‚¹ã‚¿ãƒ ãƒ†ãƒ¼ãƒã®ä½œæˆ

æ–°ã—ã„ãƒ†ãƒ¼ãƒã‚’å®šç¾©ï¼š

```css
/* brand-theme.css */
[data-theme="brand"] {
  /* ãƒ–ãƒ©ãƒ³ãƒ‰å°‚ç”¨ã®ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆ */
  --surface-base-background: #FEF3C7;
  --surface-base-foreground: #78350F;
  --surface-base-border: #FCD34D;

  --component-button-primary-background-default: #F59E0B;
  --component-button-primary-background-hover: #D97706;
  --component-button-primary-text-default: #FFFFFF;

  --text-body-default-color: #78350F;
  --text-heading-default-color: #92400E;

  --state-focus-ring-color: #F59E0B;
}
```

```javascript
// ã‚«ã‚¹ã‚¿ãƒ ãƒ†ãƒ¼ãƒã‚’é©ç”¨
document.documentElement.setAttribute('data-theme', 'brand');
```

### æ–¹æ³•3: Design Tokensã§ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

Style Dictionaryå½¢å¼ã§ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å®šç¾©ï¼š

```json
{
  "theme": {
    "custom": {
      "component": {
        "button": {
          "primary": {
            "background": {
              "default": { "value": "#8B5CF6" },
              "hover": { "value": "#7C3AED" },
              "active": { "value": "#6D28D9" }
            },
            "text": {
              "default": { "value": "#FFFFFF" }
            }
          }
        }
      },
      "surface": {
        "base": {
          "background": { "value": "#F9FAFB" },
          "foreground": { "value": "#111827" },
          "border": { "value": "#E5E7EB" }
        }
      }
    }
  }
}
```

ãƒ“ãƒ«ãƒ‰ã—ã¦ä½¿ç”¨ï¼š

```bash
cd packages/tokens
npm run build
```

### ãƒ†ãƒ¼ãƒãƒ—ãƒªã‚»ãƒƒãƒˆ

ã‚ˆãã‚ã‚‹ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºãƒ‘ã‚¿ãƒ¼ãƒ³ï¼š

#### High Contrastï¼ˆé«˜ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆï¼‰

```css
[data-theme="high-contrast"] {
  --surface-base-background: #FFFFFF;
  --surface-base-foreground: #000000;
  --text-body-default-color: #000000;
  --component-button-primary-background-default: #000000;
  --component-input-border-default: #000000;
  --state-focus-ring-width: 3px;
}
```

#### Sepiaï¼ˆã‚»ãƒ”ã‚¢ï¼‰

```css
[data-theme="sepia"] {
  --surface-base-background: #F4ECD8;
  --surface-base-foreground: #5B4636;
  --text-body-default-color: #5B4636;
  --component-button-primary-background-default: #8B7355;
  --component-card-background-default: #F9F5EB;
}
```

## ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆã®å®Ÿè£…

### æ–¹æ³•1: Theme Switcherã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

æœ€ã‚‚ç°¡å˜ãªæ–¹æ³•ï¼š

```html
<ha-theme-switcher></ha-theme-switcher>

<script type="module">
  import '@hidearea-design/core/components/theme-switcher/theme-switcher.js';
  import { initTheme } from '@hidearea-design/core/utils/theme';

  initTheme();
</script>
```

ãƒãƒªã‚¢ãƒ³ãƒˆï¼š

```html
<!-- ãƒœã‚¿ãƒ³ã‚°ãƒ«ãƒ¼ãƒ—å½¢å¼ -->
<ha-theme-switcher variant="segmented"></ha-theme-switcher>

<!-- ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³å½¢å¼ -->
<ha-theme-switcher variant="dropdown"></ha-theme-switcher>

<!-- ã‚¢ã‚¤ã‚³ãƒ³ã®ã¿ -->
<ha-theme-switcher variant="icon-only"></ha-theme-switcher>

<!-- Autoé¸æŠã‚’è¡¨ç¤º -->
<ha-theme-switcher show-auto></ha-theme-switcher>
```

### æ–¹æ³•2: ã‚«ã‚¹ã‚¿ãƒ ãƒœã‚¿ãƒ³

ç‹¬è‡ªã®UIã‚’å®Ÿè£…ï¼š

```html
<button id="theme-toggle" aria-label="Toggle theme">
  <span class="icon-light">â˜€ï¸</span>
  <span class="icon-dark">ğŸŒ™</span>
</button>

<script type="module">
  import { initTheme, toggleTheme, getEffectiveTheme, onThemeChange } from '@hidearea-design/core/utils/theme';

  initTheme();

  const button = document.getElementById('theme-toggle');
  const iconLight = button.querySelector('.icon-light');
  const iconDark = button.querySelector('.icon-dark');

  // ã‚¢ã‚¤ã‚³ãƒ³è¡¨ç¤ºã‚’æ›´æ–°
  function updateIcon(theme) {
    if (theme === 'dark') {
      iconLight.style.display = 'none';
      iconDark.style.display = 'inline';
    } else {
      iconLight.style.display = 'inline';
      iconDark.style.display = 'none';
    }
  }

  // åˆæœŸçŠ¶æ…‹
  updateIcon(getEffectiveTheme());

  // ã‚¯ãƒªãƒƒã‚¯ã§ãƒˆã‚°ãƒ«
  button.addEventListener('click', () => {
    toggleTheme();
  });

  // ãƒ†ãƒ¼ãƒå¤‰æ›´ã‚’ç›£è¦–
  onThemeChange(updateIcon);
</script>
```

### æ–¹æ³•3: ã‚»ãƒ¬ã‚¯ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼

3ã¤ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æä¾›ï¼š

```html
<select id="theme-select">
  <option value="light">Light</option>
  <option value="dark">Dark</option>
  <option value="auto">Auto</option>
</select>

<script type="module">
  import { initTheme, getTheme, setTheme, onThemeChange } from '@hidearea-design/core/utils/theme';

  initTheme();

  const select = document.getElementById('theme-select');
  select.value = getTheme();

  select.addEventListener('change', (e) => {
    setTheme(e.target.value);
  });

  onThemeChange(() => {
    select.value = getTheme();
  });
</script>
```

## é«˜åº¦ãªä½¿ç”¨æ–¹æ³•

### ãƒ†ãƒ¼ãƒãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³

ã‚¹ãƒ ãƒ¼ã‚ºãªãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼š

```css
:root {
  /* ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³å¯¾è±¡ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ */
  --theme-transition-properties: background-color, color, border-color, box-shadow;
  --theme-transition-duration: 200ms;
  --theme-transition-easing: cubic-bezier(0.4, 0, 0.2, 1);
}

/* ã™ã¹ã¦ã®è¦ç´ ã«ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ã‚’é©ç”¨ */
*,
*::before,
*::after {
  transition: var(--theme-transition-properties) var(--theme-transition-duration) var(--theme-transition-easing);
}

/* ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–: åˆå›ãƒ­ãƒ¼ãƒ‰æ™‚ã¯ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ç„¡åŠ¹ */
html.no-transition *,
html.no-transition *::before,
html.no-transition *::after {
  transition: none !important;
}
```

```javascript
import { initTheme, setTheme } from '@hidearea-design/core/utils/theme';

// åˆæœŸåŒ–æ™‚ã¯ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ç„¡åŠ¹
document.documentElement.classList.add('no-transition');
initTheme();

// ãƒ­ãƒ¼ãƒ‰å¾Œã«æœ‰åŠ¹åŒ–
window.addEventListener('load', () => {
  document.documentElement.classList.remove('no-transition');
});

// ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆ
function switchTheme(newTheme) {
  // View Transition APIãŒã‚ã‚‹å ´åˆ
  if (document.startViewTransition) {
    document.startViewTransition(() => {
      setTheme(newTheme);
    });
  } else {
    setTheme(newTheme);
  }
}
```

### Per-Componentãƒ†ãƒ¼ãƒ

ç‰¹å®šã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã ã‘ç•°ãªã‚‹ãƒ†ãƒ¼ãƒï¼š

```html
<div data-theme="light">
  <ha-button variant="primary">Light Button</ha-button>
</div>

<div data-theme="dark">
  <ha-button variant="primary">Dark Button</ha-button>
</div>
```

```css
/* ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚¹ã‚³ãƒ¼ãƒ—ã®ãƒ†ãƒ¼ãƒ */
.card[data-theme="dark"] {
  --component-card-background-default: #262626;
  --component-card-border-default: #404040;
  --text-body-default-color: #FAFAFA;
}
```

### ã‚·ã‚¹ãƒ†ãƒ ãƒ†ãƒ¼ãƒå¤‰æ›´ã®æ¤œå‡º

```javascript
import { initTheme, getTheme, getEffectiveTheme } from '@hidearea-design/core/utils/theme';

initTheme();

// ã‚·ã‚¹ãƒ†ãƒ ãƒ†ãƒ¼ãƒè¨­å®šã®å¤‰æ›´ã‚’ç›£è¦–
const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');

mediaQuery.addEventListener('change', (e) => {
  const currentTheme = getTheme();

  // Autoè¨­å®šã®å ´åˆã®ã¿åå¿œ
  if (currentTheme === 'auto') {
    const newTheme = e.matches ? 'dark' : 'light';
    console.log('System theme changed to:', newTheme);

    // å¿…è¦ã«å¿œã˜ã¦è¿½åŠ å‡¦ç†
    // ä¾‹: ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ã‚¤ãƒ™ãƒ³ãƒˆé€ä¿¡
  }
});
```

### ãƒ†ãƒ¼ãƒã”ã¨ã®ç”»åƒãƒ»ã‚¢ã‚»ãƒƒãƒˆ

```html
<picture>
  <source
    srcset="/images/hero-dark.jpg"
    media="(prefers-color-scheme: dark)"
  >
  <img src="/images/hero-light.jpg" alt="Hero image">
</picture>
```

CSSç‰ˆï¼š

```css
.logo {
  background-image: url('/images/logo-light.svg');
}

[data-theme="dark"] .logo {
  background-image: url('/images/logo-dark.svg');
}
```

### ãƒ†ãƒ¼ãƒã«åŸºã¥ãæ¡ä»¶åˆ†å²

```javascript
import { getEffectiveTheme, onThemeChange } from '@hidearea-design/core/utils/theme';

function updateChart() {
  const theme = getEffectiveTheme();

  const chartOptions = {
    theme: theme,
    colors: theme === 'dark'
      ? ['#60A5FA', '#34D399', '#FBBF24']
      : ['#3B82F6', '#10B981', '#F59E0B'],
    backgroundColor: theme === 'dark' ? '#171717' : '#FFFFFF',
    textColor: theme === 'dark' ? '#FAFAFA' : '#171717'
  };

  renderChart(chartOptions);
}

// åˆå›ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
updateChart();

// ãƒ†ãƒ¼ãƒå¤‰æ›´æ™‚ã«å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
onThemeChange(updateChart);
```

## ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### 1. ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½¿ç”¨

```css
/* âœ“ è‰¯ã„ä¾‹ */
.button {
  background: var(--component-button-primary-background-default);
  color: var(--component-button-primary-text-default);
}

/* âœ— æ‚ªã„ä¾‹ */
.button {
  background: #3B82F6;
  color: white;
}
```

### 2. ãƒ†ãƒ¼ãƒã«ä¾å­˜ã—ãªã„å®Ÿè£…

```javascript
// âœ“ è‰¯ã„ä¾‹: ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½¿ç”¨
element.style.setProperty('background', 'var(--surface-raised-background)');

// âœ— æ‚ªã„ä¾‹: ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸè‰²
element.style.background = '#FFFFFF';
```

### 3. ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆæ¯”ã®ç¢ºä¿

```css
/* WCAG AAæº–æ‹ ï¼ˆ4.5:1ä»¥ä¸Šï¼‰ */
[data-theme="light"] {
  --text-body-default-color: #171717; /* on #FFFFFF = 16.1:1 */
  --text-body-muted-color: #525252;   /* on #FFFFFF = 7.6:1 */
}

[data-theme="dark"] {
  --text-body-default-color: #FAFAFA; /* on #171717 = 15.6:1 */
  --text-body-muted-color: #A3A3A3;   /* on #171717 = 5.9:1 */
}
```

### 4. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

```javascript
// âœ“ è‰¯ã„ä¾‹: ãƒ‡ãƒã‚¦ãƒ³ã‚¹
import { setTheme } from '@hidearea-design/core/utils/theme';

let timeoutId;
function debouncedSetTheme(theme) {
  clearTimeout(timeoutId);
  timeoutId = setTimeout(() => {
    setTheme(theme);
  }, 100);
}

// âœ— æ‚ªã„ä¾‹: é »ç¹ãªåˆ‡ã‚Šæ›¿ãˆ
element.addEventListener('mousemove', () => {
  setTheme(Math.random() > 0.5 ? 'light' : 'dark');
});
```

### 5. ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£

```html
<!-- âœ“ è‰¯ã„ä¾‹: ARIAãƒ©ãƒ™ãƒ« -->
<button
  id="theme-toggle"
  aria-label="Switch to dark mode"
  aria-pressed="false"
>
  Toggle Theme
</button>

<script>
  const button = document.getElementById('theme-toggle');

  onThemeChange((theme) => {
    const isDark = theme === 'dark';
    button.setAttribute('aria-pressed', isDark);
    button.setAttribute('aria-label',
      isDark ? 'Switch to light mode' : 'Switch to dark mode'
    );
  });
</script>
```

### 6. SSRå¯¾å¿œ

```javascript
// ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰: ã‚¯ãƒƒã‚­ãƒ¼ã«ãƒ†ãƒ¼ãƒã‚’ä¿å­˜
function getThemeFromCookie() {
  const cookies = document.cookie.split(';');
  const themeCookie = cookies.find(c => c.trim().startsWith('theme='));
  return themeCookie ? themeCookie.split('=')[1] : 'auto';
}

// ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰: åˆæœŸåŒ–å‰ã«é©ç”¨
const savedTheme = getThemeFromCookie();
document.documentElement.setAttribute('data-theme',
  savedTheme === 'auto'
    ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light')
    : savedTheme
);

// ãã®å¾Œé€šå¸¸ã®åˆæœŸåŒ–
initTheme();
```

### 7. ãƒ†ã‚¹ãƒˆã®å®Ÿè£…

```javascript
// ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆã®ãƒ†ã‚¹ãƒˆ
describe('Theme System', () => {
  beforeEach(() => {
    localStorage.clear();
    document.documentElement.removeAttribute('data-theme');
  });

  it('should default to auto mode', () => {
    initTheme();
    expect(getTheme()).toBe('auto');
  });

  it('should switch to dark mode', () => {
    initTheme();
    setTheme('dark');
    expect(document.documentElement.getAttribute('data-theme')).toBe('dark');
  });

  it('should persist theme in localStorage', () => {
    setTheme('dark');
    expect(localStorage.getItem('ha-theme')).toBe('dark');
  });

  it('should toggle between light and dark', () => {
    setTheme('light');
    toggleTheme();
    expect(getEffectiveTheme()).toBe('dark');
    toggleTheme();
    expect(getEffectiveTheme()).toBe('light');
  });
});
```

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### å•é¡Œ: ãƒ†ãƒ¼ãƒãŒé©ç”¨ã•ã‚Œãªã„

**åŸå› **: CSSå¤‰æ•°ãŒãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ãªã„

**è§£æ±ºç­–**:
```html
<!-- ãƒˆãƒ¼ã‚¯ãƒ³CSSã‚’å¿…ãšã‚¤ãƒ³ãƒãƒ¼ãƒˆ -->
<link rel="stylesheet" href="@hidearea-design/tokens/css/variables.css">
```

### å•é¡Œ: ã¡ã‚‰ã¤ããŒç™ºç”Ÿã™ã‚‹

**åŸå› **: åˆæœŸåŒ–ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒé…ã„

**è§£æ±ºç­–**:
```html
<head>
  <!-- ã§ãã‚‹ã ã‘æ—©ãå®Ÿè¡Œ -->
  <script>
    const theme = localStorage.getItem('ha-theme') || 'auto';
    const effective = theme === 'auto'
      ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light')
      : theme;
    document.documentElement.setAttribute('data-theme', effective);
  </script>
</head>
```

### å•é¡Œ: ã‚·ã‚¹ãƒ†ãƒ ãƒ†ãƒ¼ãƒã«è¿½å¾“ã—ãªã„

**åŸå› **: Autoè¨­å®šæ™‚ã®ãƒªã‚¹ãƒŠãƒ¼ãŒå‹•ä½œã—ã¦ã„ãªã„

**è§£æ±ºç­–**:
```javascript
// å¿…ãšinitTheme()ã‚’å‘¼ã³å‡ºã™
initTheme();

// Autoè¨­å®šã«ãªã£ã¦ã„ã‚‹ã‹ç¢ºèª
console.log(getTheme()); // 'auto'ã§ã‚ã‚‹ã¹ã
```

### å•é¡Œ: ã‚«ã‚¹ã‚¿ãƒ ãƒˆãƒ¼ã‚¯ãƒ³ãŒåŠ¹ã‹ãªã„

**åŸå› **: è©³ç´°åº¦ã®å•é¡Œ

**è§£æ±ºç­–**:
```css
/* âœ— è©³ç´°åº¦ãŒä½ã„ */
:root {
  --component-button-primary-background-default: red;
}

/* âœ“ ãƒ†ãƒ¼ãƒã‚»ãƒ¬ã‚¯ã‚¿ã‚’ä½¿ç”¨ */
[data-theme="light"] {
  --component-button-primary-background-default: red;
}
```

### å•é¡Œ: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒæ‚ªã„

**åŸå› **: ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ãŒå¤šã™ãã‚‹

**è§£æ±ºç­–**:
```css
/* å¿…è¦ãªãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã ã‘ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ */
* {
  transition: background-color 200ms, color 200ms;
}

/* transform, opacityã¯é™¤å¤–ï¼ˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã§ä½¿ã†ï¼‰ */
```

### ãƒ‡ãƒãƒƒã‚°ãƒ’ãƒ³ãƒˆ

```javascript
// ç¾åœ¨ã®ãƒ†ãƒ¼ãƒçŠ¶æ…‹ã‚’ç¢ºèª
console.log({
  stored: localStorage.getItem('ha-theme'),
  current: getTheme(),
  effective: getEffectiveTheme(),
  attribute: document.documentElement.getAttribute('data-theme'),
  systemPreference: window.matchMedia('(prefers-color-scheme: dark)').matches
});

// ã™ã¹ã¦ã®ãƒ†ãƒ¼ãƒãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç¢ºèª
const styles = getComputedStyle(document.documentElement);
const tokens = Array.from(document.styleSheets)
  .flatMap(sheet => Array.from(sheet.cssRules || []))
  .filter(rule => rule.selectorText?.includes('[data-theme='))
  .flatMap(rule => Array.from(rule.style))
  .filter(prop => prop.startsWith('--'));

console.log('Theme tokens:', [...new Set(tokens)]);
```

## ã¾ã¨ã‚

Hidearea Design Systemã®ãƒ†ãƒ¼ãƒã‚·ã‚¹ãƒ†ãƒ ã¯ï¼š

- **ç°¡å˜ã«å§‹ã‚ã‚‰ã‚Œã‚‹**: `initTheme()`ã ã‘ã§åŸºæœ¬æ©Ÿèƒ½ãŒä½¿ãˆã‚‹
- **æŸ”è»Ÿã«ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½**: CSSå¤‰æ•°ã§ç°¡å˜ã«ä¸Šæ›¸ã
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–æ¸ˆã¿**: åŠ¹ç‡çš„ãªå®Ÿè£…
- **ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£å¯¾å¿œ**: WCAGæº–æ‹ ã®ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆæ¯”
- **é–‹ç™ºè€…ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼**: è±Šå¯ŒãªAPIã€ãƒ‡ãƒãƒƒã‚°ãƒ„ãƒ¼ãƒ«

è©³ç´°ãªå®Ÿè£…ä¾‹ã¯[examples/](../../examples/)ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒˆãƒ¼ã‚¯ãƒ³ã‚¬ã‚¤ãƒ‰](../../packages/tokens/docs/ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒˆãƒ¼ã‚¯ãƒ³ã‚¬ã‚¤ãƒ‰.md)
- [ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚¬ã‚¤ãƒ‰](../../packages/tokens/docs/ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚¬ã‚¤ãƒ‰.md)
- [Theme Switcherã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ](../../packages/core/src/components/theme-switcher/README.md)
