# Hidearea Design System - 包括的トークンレビューレポート

**日付:** 2025-12-09
**バージョン:** 1.0
**レビュアー:** Claude Code (自動分析)

---

## エグゼクティブサマリー

本レポートは、Hidearea Design Systemトークンパッケージ(`@hidearea-design/tokens`)の包括的なレビューを提供します。分析の結果、優れた構造と最新のツールを備えた本番環境対応のデザイントークンシステムであることが判明しました。ただし、一貫性、完全性、保守性において改善の余地があります。

### 全体評価

- **アーキテクチャ:** 優秀 (二層CSS変数システム、Shadow DOM対応)
- **トークン構成:** 良好 (一部の構造的不整合あり)
- **命名の一貫性:** 中程度 (改善の余地あり)
- **完全性:** 良好 (一部のトークンが不足)
- **型安全性:** 優秀 (自動生成されたTS型定義)
- **ドキュメント:** 良好 (使用ガイドあり)

---

## 1. アーキテクチャ分析

### 1.1 現在のアーキテクチャ

トークンシステムは洗練された二層CSS変数アーキテクチャを使用しています:

```
:root {
  /* ベーストークン */
  --color-blue-500: #3b82f6;

  /* セマンティックトークン（テーマフォールバック付き） */
  --background-primary: var(--theme-bg-primary, #ffffff);
}

[data-theme="light"] {
  --theme-bg-primary: #ffffff;
}

[data-theme="dark"] {
  --theme-bg-primary: #171717;
}
```

**強み:**
- Shadow DOM対応
- SSR用のフォールバック値
- 関心の明確な分離
- アクセシビリティサポート (prefers-reduced-motion)

**弱み:**
- テーマトークンはYAMLで定義されているが、セマンティックトークンはJSONで定義
- 一貫性のないファイル形式の混在

### 1.2 ファイル構成

```
src/
├── base/              # YAML - プリミティブトークン
│   ├── colors.yaml
│   ├── typography.yaml
│   ├── spacing.yaml
│   ├── borders.yaml
│   ├── shadows.yaml
│   ├── animations.yaml
│   └── breakpoints.yaml
├── semantic/          # JSON - セマンティックトークン
│   ├── colors.json
│   ├── typography.json
│   ├── components.json
│   ├── surfaces.json
│   ├── states.json
│   ├── layout.json
│   ├── interactions.json
│   └── aliases.json
└── themes/            # YAML - テーマオーバーライド
    ├── light/
    │   └── colors.yaml
    └── dark/
        └── colors.yaml
```

**特定された問題:**
1. **混在するファイル形式:** ベーストークンはYAML、セマンティックトークンはJSON
2. **不完全なカバレッジ:** 全てのベーストークンに対応するセマンティック抽象化が存在しない
3. **テーマ構造:** 色のみがテーマ化されており、他のトークン(タイポグラフィ、スペーシング)にはダークモードのバリアントが欠如

---

## 2. トークンカテゴリ分析

### 2.1 ベーストークン (プリミティブ層)

#### 2.1.1 カラー (src/base/colors.yaml)

**強み:**
- 包括的なカラーパレット (各色9段階)
- 日本語コメント付きで十分に文書化
- セマンティックなカラー命名 (success, warning, error, info)

**問題:**
- `color.gray.25`, `color.gray.750`, `color.gray.950`が欠落 (aliases.jsonで参照されているが未定義)
- オレンジ色のパレットがない (セカンダリアクションによく使用される)
- パープルは定義されているが活用不足

**推奨事項:**
1. 欠落しているグレーシェードを追加:
   ```yaml
   gray:
     25:
       value: "#fcfcfc"
       comment: "ほぼ白に近いグレー"
     750:
       value: "#3a3a3a"
       comment: "濃いグレー"
     950:
       value: "#0a0a0a"
       comment: "ほぼ黒に近いグレー"
   ```

2. 第三のアクション/警告用にオレンジパレットの追加を検討

#### 2.1.2 タイポグラフィ (src/base/typography.yaml)

**強み:**
- 完全なフォントスケール (xsから9xlまで)
- 包括的なウェイトスケール (100-900)
- 柔軟な行の高さシステム

**問題:**
- 行の高さの値は単位なしだが、異なるスケールが混在 (1, 1.25, 1.5, 2)
- レタースペーシングは`em`単位を使用しており、一貫したスケーリングができない可能性
- フォントファミリーのフォールバックが基本的 (最新の標準からのシステムフォントスタックを使用可能)

**推奨事項:**
1. 一貫した数学的進行を使用して行の高さスケールを標準化
2. フォントスタックを更新して最新のシステムフォントを含める:
   ```yaml
   sans:
     value: "-apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji'"
   ```

#### 2.1.3 スペーシング (src/base/spacing.yaml)

**強み:**
- 包括的なスケール (0から96まで)
- アクセシビリティのためにrem単位を使用
- 明確なドキュメント

**問題:**
- 64から72、80、96への大きなジャンプ (一貫性のない4/8/16パターン)
- 0と0.5の間に分数値がない

**推奨事項:**
1. 0.25rem (16px基準で1px相当) の追加を検討
2. 4pxベース単位システムをより明示的に文書化

#### 2.1.4 ボーダー (src/base/borders.yaml)

**強み:**
- 明確な角丸スケール
- ピル型要素用の`full`を含む

**問題:**
- ボーダー幅スケールが4から8にジャンプ (6pxオプションなし)
- ボーダースタイルトークンがない (solid, dashed, dotted)

**推奨事項:**
1. ボーダースタイルトークンを追加:
   ```yaml
   border:
     style:
       solid:
         value: "solid"
       dashed:
         value: "dashed"
       dotted:
         value: "dotted"
       none:
         value: "none"
   ```

#### 2.1.5 シャドウ (src/base/shadows.yaml)

**強み:**
- 包括的な立体スケール
- インナーシャドウを含む
- 最新のデザインシステムと一貫性

**問題:**
- 全てのシャドウが低不透明度の黒を使用 (0.05-0.25)
- 色付きシャドウがない (フォーカスリング、エラー状態に有用)
- ダークモードのシャドウが明るすぎる

**推奨事項:**
1. ライト/ダークテーマ用に別々のシャドウトークンを作成
2. インタラクティブ状態用に色付きシャドウを追加

#### 2.1.6 アニメーション (src/base/animations.yaml)

**強み:**
- 適切な継続時間スケール
- 標準的なイージング関数
- prefers-reduced-motionによるアクセシビリティサポート

**問題:**
- 限定的な継続時間オプション (マイクロインタラクション用の超高速が欠落)
- ブランドモーション用のカスタムcubic-bezier曲線がない

**推奨事項:**
1. ボタンフィードバック用に`duration.ultraFast: 100ms`を追加
2. ブランドイージング曲線を検討

#### 2.1.7 ブレークポイント (src/base/breakpoints.yaml)

**強み:**
- モバイルファーストアプローチ
- 標準的なブレークポイント値

**問題:**
- 非常に小さな画面用の`xs`ブレークポイントがない
- コンテナクエリ用のmax-widthブレークポイントがない

**推奨事項:**
1. 小型スマートフォン用に`xs: 480px`を追加
2. モバイルファーストvs.デスクトップファースト戦略を文書化

---

### 2.2 セマンティックトークン (抽象化層)

#### 2.2.1 セマンティックカラー (src/semantic/colors.json)

**強み:**
- セマンティックからベースカラーへの明確なマッピング
- 一貫した10段階システム

**問題:**
- 追加のセマンティック意味のない直接的なエイリアス
- `neutral`は`gray`にマップ (冗長)
- `secondary`は`gray`にマップ (セカンダリとしてのpurpleと競合)

**推奨事項:**
1. `neutral`エイリアスを削除 (`gray`を直接使用)
2. `secondary`マッピングを修正:
   ```json
   "color": {
     "action": {
       "primary": { "value": "{color.primary.500}" },
       "secondary": { "value": "{color.secondary.500}" },
       "destructive": { "value": "{color.error.500}" }
     }
   }
   ```

#### 2.2.2 タイポグラフィセマンティックトークン (src/semantic/typography.json)

**強み:**
- 包括的なテキストスタイル (heading, body, caption, label)
- コードスタイリングを含む
- リンク状態を定義

**問題:**
- 見出しレベル間で一貫性のない構造 (h1-h6は4つのプロパティ、他は2-3)
- レスポンシブタイポグラフィトークンがない
- リンクの`visited`色が`purple`を使用しているが、ブランドカラーと競合する可能性
- コードブロックがトークンの代わりにハードコードされた値を使用

**推奨事項:**
1. レスポンシブタイポグラフィトークンを追加:
   ```json
   "text": {
     "heading": {
       "h1": {
         "fontSize": {
           "mobile": { "value": "{font.size.2xl}" },
           "tablet": { "value": "{font.size.3xl}" },
           "desktop": { "value": "{font.size.4xl}" }
         }
       }
     }
   }
   ```

2. コードブロックにセマンティックカラートークンを使用
3. 一貫性のために全てのテキストスタイルに`fontFamily`を追加

#### 2.2.3 コンポーネントトークン (src/semantic/components.json)

**強み:**
- 包括的なコンポーネントカバレッジ (9コンポーネント)
- 一貫した状態命名 (default, hover, active, disabled)
- 適切な関心の分離 (background, text, border)

**問題:**

**ボタンコンポーネント:**
- アクセシビリティのための`focus`状態が欠落
- ゴーストボタンにボーダートークンがない
- サイズバリアント (small, medium, large) がない
- ローディング状態トークンが欠落

**入力コンポーネント:**
- `focus-error`と`focus-success`の複合状態が欠落
- サイズトークンがない
- ヘルパーテキストスタイリングが欠落
- invalid/validアイコンがない

**カードコンポーネント:**
- キーボードナビゲーション用の`focus`状態が欠落
- 立体変更用のシャドウトークンがない
- ヘッダー/フッター/ボディセクションが欠落

**モーダルコンポーネント:**
- わずか2トークン (深刻に不完全)
- ヘッダー、フッター、閉じるボタントークンが欠落
- アニメーション/トランジショントークンがない
- バックドロップぼかしが欠落

**ツールチップコンポーネント:**
- わずか2トークン (深刻に不完全)
- 矢印スタイリングが欠落
- 位置関連トークンがない
- 最大幅制約がない

**バッジコンポーネント:**
- 一貫したバリアント構造
- サイズトークンが欠落
- アイコンサポートトークンがない

**アラートコンポーネント:**
- 適切なバリアントカバレッジ
- 閉じるボタントークンが欠落
- タイトル/説明スタイリングの区別がない

**テーブルコンポーネント:**
- 基本構造が存在
- セルパディングトークンが欠落
- ソートインジケータートークンがない
- ローディング/空状態が欠落

**ナビゲーションコンポーネント:**
- 基本構造が存在
- サブメニュートークンが欠落
- モバイルメニュートークンがない
- 区切り線/セパレータートークンが欠落

**推奨事項:**

包括的なコンポーネントトークン構造テンプレートを作成:

```json
{
  "component": {
    "button": {
      "size": {
        "small": {
          "height": { "value": "{spacing.8}" },
          "paddingX": { "value": "{spacing.3}" },
          "paddingY": { "value": "{spacing.2}" },
          "fontSize": { "value": "{font.size.sm}" }
        },
        "medium": { /* ... */ },
        "large": { /* ... */ }
      },
      "primary": {
        "background": { /* 全ての状態 */ },
        "text": { /* 全ての状態 */ },
        "border": { /* 全ての状態 */ },
        "shadow": {
          "default": { "value": "none" },
          "hover": { "value": "{shadow.sm}" },
          "focus": { "value": "{state.focus.ring.color}" },
          "active": { "value": "none" }
        }
      }
    }
  }
}
```

#### 2.2.4 サーフェストークン (src/semantic/surfaces.json)

**強み:**
- 明確な立体階層 (base, raised, overlay, sunken)
- マルチレベルシステム (0-3)
- インタラクティブサーフェス状態

**問題:**
- シャドウトークンとリテラル値の混在使用
- `sunken.elevation`がトークンの代わりにリテラルインセットシャドウを使用
- グラスモーフィズム効果用のカラーオーバーレイがない
- backdrop-filterトークンが欠落

**推奨事項:**
1. 全てのリテラル値をトークン参照に変換
2. バックドロップフィルタートークンを追加:
   ```json
   "surface": {
     "glass": {
       "background": { "value": "rgba(255, 255, 255, 0.8)" },
       "backdropFilter": { "value": "blur(10px)" }
     }
   }
   ```

#### 2.2.5 状態トークン (src/semantic/states.json)

**強み:**
- 包括的なインタラクション状態
- アクセシビリティ重視 (フォーカスリング、無効化)
- 適切なセマンティックカバレッジ (success, warning, error, info)

**問題:**
- `focus.ring`は深くネストされているがグローバルに使用される
- `focus-visible`の区別が欠落 (キーボードvs.マウス)
- `active.scale`はtransformを使用しているが対応するトランジションがない
- ローディング状態は不透明度のみ (アニメーション参照が欠落)
- `active`とは異なる`pressed`状態がない

**推奨事項:**
1. より簡単なアクセスのためにフォーカストークンをフラット化:
   ```json
   "state": {
     "focus": {
       "ring": { "value": "2px solid {color.primary.500}" },
       "ringOffset": { "value": "2px" },
       "ringVisible": { "value": "2px solid {color.primary.500}" }
     }
   }
   ```

2. ローディングアニメーション参照を追加:
   ```json
   "loading": {
     "opacity": { "value": "0.6" },
     "animation": { "value": "{interaction.animation.fadeIn}" }
   }
   ```

#### 2.2.6 レイアウトトークン (src/semantic/layout.json)

**強み:**
- レスポンシブコンテナサイズ
- レスポンシブカラムを持つグリッドシステム
- スタックとインラインスペーシングオプション

**問題:**
- コンテナパディングがセマンティックエイリアス (mobile, tablet, desktop) を使用しているが、これらはブレークポイントとして定義されていない
- グリッドカラムがトークンの代わりにリテラル数値を使用
- flexbox用のgapトークンがない
- モバイルデバイス用のセーフエリアインセットが欠落

**推奨事項:**
1. レスポンシブ命名をブレークポイントと整合:
   ```json
   "container": {
     "padding": {
       "sm": { "value": "{spacing.md}" },
       "md": { "value": "{spacing.lg}" },
       "lg": { "value": "{spacing.xl}" }
     }
   }
   ```

2. セーフエリアトークンを追加:
   ```json
   "layout": {
     "safeArea": {
       "top": { "value": "env(safe-area-inset-top, 0)" },
       "right": { "value": "env(safe-area-inset-right, 0)" },
       "bottom": { "value": "env(safe-area-inset-bottom, 0)" },
       "left": { "value": "env(safe-area-inset-left, 0)" }
     }
   }
   ```

#### 2.2.7 インタラクショントークン (src/semantic/interactions.json)

**強み:**
- 明確なトランジションタイミング構造
- アニメーションプリセット (fadeIn, slideIn等)
- カーソルタイプ定義

**問題:**
- アニメーショントークンは継続時間とタイミングのみで、実際のアニメーション定義が欠落
- モバイル用のハプティックフィードバックトークンがない
- スクロール動作トークンが欠落
- user-selectトークンがない

**推奨事項:**
1. 完全なアニメーション定義を追加:
   ```json
   "animation": {
     "fadeIn": {
       "keyframes": { "value": "fadeIn" },
       "duration": { "value": "{animation.duration.base}" },
       "timing": { "value": "{animation.easing.easeIn}" },
       "fillMode": { "value": "forwards" }
     }
   }
   ```

2. ユーティリティインタラクショントークンを追加:
   ```json
   "interaction": {
     "scrollBehavior": {
       "smooth": { "value": "smooth" },
       "auto": { "value": "auto" }
     },
     "userSelect": {
       "none": { "value": "none" },
       "text": { "value": "text" },
       "all": { "value": "all" }
     }
   }
   ```

#### 2.2.8 エイリアス (src/semantic/aliases.json)

**強み:**
- 便利なセマンティックショートカットを提供
- ベーススペーシングを名前付きサイズにマップ

**問題:**
- ベーストークンに存在しないgray.25、gray.750、gray.950を追加
- スペーシングエイリアスは既存のスペーシングスケールと冗長
- 明確な命名規則がない (xs, sm, md, lg, xl, 2xl)

**推奨事項:**
1. ベースに欠落しているグレーシェードを追加するか、エイリアスから削除
2. 冗長なスペーシングエイリアスの削除を検討
3. 一貫した命名を使用: `xs`, `sm`, `md`, `lg`, `xl`の代わりに`tiny`, `small`, `medium`, `large`, `xlarge`

---

### 2.3 テーマトークン

#### 2.3.1 ライトテーマ (src/themes/light/colors.yaml)

**強み:**
- 包括的なセマンティックカラーマッピング
- 明確な階層 (primary, secondary, tertiary)
- 適切な状態バリアント (default, hover, active, subtle)

**問題:**
- 色のみがテーマ化 (タイポグラフィ、スペーシング、シャドウが含まれない)
- 参照で`.value`サフィックスを使用し、冗長なトークン名を作成
- コンポーネント固有のオーバーライドがない

**推奨事項:**
1. 参照から`.value`サフィックスを削除:
   ```yaml
   background:
     primary:
       value: "{color.white}"  # "{color.white.value}"の代わりに
   ```

2. コンポーネント固有のテーマオーバーライドを追加:
   ```yaml
   theme:
     light:
       component:
         button:
           primary:
             background: "{color.blue.500}"
   ```

#### 2.3.2 ダークテーマ (src/themes/dark/colors.yaml)

**強み:**
- ライトテーマと同じ構造を維持
- カラー階層を適切に反転

**問題:**
- ライトテーマと同じ問題
- シャドウが暗い背景で暗すぎる
- ダークモードのカード/モーダル用の立体サーフェスカラーがない

**推奨事項:**
1. ダークモード固有のシャドウを追加:
   ```yaml
   theme:
     dark:
       shadow:
         sm:
           value: "0 1px 2px 0 rgba(0, 0, 0, 0.5)"
   ```

2. 立体サーフェスを追加:
   ```yaml
   background:
     elevated:
       value: "{color.gray.800}"
     overlay:
       value: "{color.gray.750}"
   ```

---

## 3. 命名規則分析

### 3.1 現在のパターン

システムは混在した命名パターンを使用:

1. **ベーストークン:** `category.property.scale`
   - 例: `color.blue.500`, `spacing.4`, `font.size.xl`

2. **セマンティックトークン:** `category.concept.property.state`
   - 例: `component.button.primary.background.default`

3. **CSS変数:** `--category-property-scale`
   - 例: `--color-blue-500`, `--spacing-4`

### 3.2 不整合

1. **スケール命名:**
   - 色は数値を使用: 50, 100, 200... 900
   - スペーシングは数値を使用: 0, 1, 2... 96
   - フォントサイズはTシャツサイズを使用: xs, sm, base, lg, xl, 2xl...
   - ボーダー角丸はTシャツサイズを使用: sm, base, md, lg, xl...

2. **状態命名:**
   - 一部は過去形を使用: `selected`, `disabled`
   - 一部は現在形: `hover`, `active`, `focus`
   - ネスト構造での不整合な順序

3. **セマンティック層:**
   - 一部のトークンは深くネスト (6レベル以上)
   - 他はフラット (2-3レベル)
   - ネストとフラット化のタイミングに明確なパターンがない

### 3.3 推奨事項

1. **明確な命名ルールを確立:**

   ```
   ベーストークン:
   {category}.{type}.{scale}

   セマンティックトークン:
   {domain}.{concept}.{property}.{variant}.{state}

   最大ネスト深度: 5レベル
   ```

2. **スケール命名を標準化:**

   人間向けスケールには全てTシャツサイズを使用:
   - `2xs`, `xs`, `sm`, `md`, `lg`, `xl`, `2xl`, `3xl`, `4xl`

   プログラマティックスケールには数値を使用:
   - カラーウェイト: 50-900 (100刻み)
   - スペーシング: 0-96 (4刻み)

3. **状態順序を標準化:**
   ```
   default → hover → focus → active → disabled
   ```

---

## 4. 構造的問題と技術的負債

### 4.1 ファイル形式の不整合

**問題:** ベーストークンはYAML、セマンティックトークンはJSON、テーマはYAML

**影響:**
- コントリビューターにとって混乱
- 複数のパーサーが必要
- 一貫性のないコメント機能

**解決策:**
全てのトークン定義をYAMLに標準化:
- より優れたコメントサポート
- 人間にとって読みやすい
- 一貫したツール

**移行パス:**
1. セマンティックトークンをYAMLに変換
2. ビルド設定を更新
3. 既存のトークン構造を保持

### 4.2 不完全なコンポーネントカバレッジ

**問題:** コンポーネントトークンが不完全で一貫性がない

**大幅な作業が必要なコンポーネント:**
- Modal (95%不完全)
- Tooltip (90%不完全)
- Navigation (70%不完全)
- Table (60%不完全)

**解決策:**
各コンポーネントタイプ用の包括的なコンポーネントトークンテンプレートを作成:

**例 - モーダルトークンテンプレート:**
```yaml
component:
  modal:
    # 寸法
    width:
      small: { value: "400px" }
      medium: { value: "600px" }
      large: { value: "800px" }
      fullscreen: { value: "100vw" }

    # スペーシング
    padding:
      header: { value: "{spacing.6}" }
      body: { value: "{spacing.6}" }
      footer: { value: "{spacing.6}" }

    # カラー
    background:
      default: { value: "{surface.overlay.background}" }
      overlay: { value: "rgba(0, 0, 0, 0.5)" }

    # ボーダー
    border:
      width: { value: "{border.width.1}" }
      radius: { value: "{border.radius.lg}" }
      color: { value: "{color.border.default}" }

    # シャドウ
    shadow:
      default: { value: "{shadow.2xl}" }

    # アニメーション
    animation:
      enter:
        duration: { value: "{animation.duration.base}" }
        timing: { value: "{animation.easing.easeOut}" }
      exit:
        duration: { value: "{animation.duration.fast}" }
        timing: { value: "{animation.easing.easeIn}" }

    # ヘッダー
    header:
      background: { value: "transparent" }
      borderBottom: { value: "1px solid {color.border.default}" }
      padding: { value: "{spacing.6}" }
      title:
        fontSize: { value: "{font.size.xl}" }
        fontWeight: { value: "{font.weight.semibold}" }
        color: { value: "{color.foreground.primary}" }

    # フッター
    footer:
      background: { value: "{color.background.secondary}" }
      borderTop: { value: "1px solid {color.border.default}" }
      padding: { value: "{spacing.6}" }
      gap: { value: "{spacing.3}" }

    # 閉じるボタン
    closeButton:
      size: { value: "{spacing.8}" }
      background:
        default: { value: "transparent" }
        hover: { value: "{color.background.secondary}" }
      color:
        default: { value: "{color.foreground.secondary}" }
        hover: { value: "{color.foreground.primary}" }
```

### 4.3 テーマカバレッジのギャップ

**問題:** 色のみがテーマ化されているが、タイポグラフィとスペーシングもダークモードに対応すべき

**欠落しているテーマオーバーライド:**
- 暗い背景用のタイポグラフィコントラスト調整
- ダークモード用のシャドウ調整
- ボーダーウェイト調整
- フォーカスリングの色

**解決策:**
全ての視覚的プロパティを含むようにテーマファイルを拡張:

```yaml
theme:
  dark:
    # 既存のカラーオーバーライド...

    # タイポグラフィ調整
    typography:
      body:
        color:
          primary: { value: "{color.gray.100}" }
          secondary: { value: "{color.gray.400}" }

    # シャドウ調整
    shadow:
      sm: { value: "0 1px 2px 0 rgba(0, 0, 0, 0.5)" }
      md: { value: "0 4px 6px -1px rgba(0, 0, 0, 0.5)" }
      lg: { value: "0 10px 15px -3px rgba(0, 0, 0, 0.5)" }

    # ボーダー調整
    border:
      color:
        default: { value: "{color.gray.700}" }
        subtle: { value: "{color.gray.800}" }
        strong: { value: "{color.gray.600}" }
```

### 4.4 欠落しているアクセシビリティトークン

**問題:** アクセシビリティ固有のトークンが限定的

**欠落:**
- ハイコントラストモードのオーバーライド
- キーボードナビゲーション用のフォーカスインジケーター
- スクリーンリーダー固有のトークン
- タッチターゲットの最小サイズ

**解決策:**
アクセシビリティトークンカテゴリを追加:

```yaml
accessibility:
  focus:
    outline:
      width: { value: "2px" }
      style: { value: "solid" }
      color: { value: "{color.primary.500}" }
      offset: { value: "2px" }
    visible:
      outline: { value: "2px solid {color.primary.500}" }

  touch:
    minSize: { value: "44px" }
    minSpacing: { value: "8px" }

  contrast:
    high:
      background: { value: "{color.white}" }
      foreground: { value: "{color.black}" }
      border: { value: "2px solid {color.black}" }
```

---

## 5. ビルド設定分析

### 5.1 現在の設定 (config.mjs)

**強み:**
- Shadow DOM用のカスタム二層CSSフォーマット
- 複数の出力フォーマット (CSS, JS, TS)
- reduced motionメディアクエリサポート

**問題:**
- YAMLパーサーが登録されているがソースにはJSONファイルのみ含む
- トークン検証がない
- 自動ドキュメント生成がない
- 限定的なプラットフォーム出力 (SCSS、iOS、Androidなし)

**推奨事項:**

1. **ソースパターンを修正:**
   ```javascript
   source: [
     'src/base/**/*.yaml',
     'src/semantic/**/*.json',
     'src/themes/**/*.yaml'
   ]
   ```

2. **トークン検証を追加:**
   ```javascript
   StyleDictionary.registerTransform({
     name: 'validate/token-references',
     type: 'value',
     transitive: true,
     transformer: (token) => {
       // 参照されたトークンが存在するか検証
       // 欠落している参照でエラーをスロー
       return token.value;
     }
   });
   ```

3. **ドキュメント出力を追加:**
   ```javascript
   platforms: {
     // ...既存のプラットフォーム
     docs: {
       transformGroup: 'js',
       buildPath: 'docs/',
       files: [{
         destination: 'tokens.json',
         format: 'json'
       }]
     }
   }
   ```

4. **追加プラットフォームを追加:**
   ```javascript
   scss: {
     transformGroup: 'scss',
     buildPath: 'build/scss/',
     files: [{
       destination: '_variables.scss',
       format: 'scss/variables'
     }]
   },
   ios: {
     transformGroup: 'ios',
     buildPath: 'build/ios/',
     files: [{
       destination: 'Tokens.swift',
       format: 'ios-swift/class.swift',
       className: 'Tokens'
     }]
   },
   android: {
     transformGroup: 'android',
     buildPath: 'build/android/',
     files: [{
       destination: 'tokens.xml',
       format: 'android/resources'
     }]
   }
   ```

---

## 6. 一貫性とベストプラクティス

### 6.1 トークン参照パターン

**現在の問題:**
1. 一部の参照は`.value`サフィックスを使用: `{color.white.value}`
2. 他は使用しない: `{color.primary.500}`
3. ファイル間で一貫性がない

**ベストプラクティス:**
トークン参照に`.value`を含めない。Style Dictionaryが自動的に処理します。

**正しい:**
```yaml
background:
  primary:
    value: "{color.white}"
```

**誤り:**
```yaml
background:
  primary:
    value: "{color.white.value}"
```

### 6.2 トークン構成の原則

**推奨構造:**

```
ベーストークン (プリミティブ)
├── Colors (色相、彩度、明度)
├── Typography (サイズ、ウェイト、ファミリー)
├── Spacing (スケール)
├── Borders (幅、角丸、スタイル)
├── Shadows (立体)
├── Animation (継続時間、イージング)
└── Breakpoints (画面サイズ)

セマンティックトークン (意味)
├── Colors (意図ベース)
├── Typography (役割ベース)
├── Surfaces (コンテキストベース)
├── States (インタラクションベース)
├── Layout (構造ベース)
└── Interactions (動作ベース)

コンポーネントトークン (使用法)
├── Button (バリアント、サイズ、状態)
├── Input (バリアント、サイズ、状態)
├── Card (バリアント、サイズ、状態)
└── ... (全てのUIコンポーネント)

テーマトークン (外観)
├── Light (カラーオーバーライド)
├── Dark (カラーオーバーライド)
├── High Contrast (アクセシビリティ)
└── Custom (ブランドバリエーション)
```

### 6.3 ドキュメント標準

**現状:**
- 一部のトークンはYAMLにコメントあり
- JSONトークンにはインラインドキュメントなし
- 生成されたドキュメントなし

**推奨事項:**

1. **全てのトークンにJSDocスタイルのコメントを追加:**
   ```yaml
   color:
     primary:
       500:
         value: "#3b82f6"
         comment: "プライマリブランドカラー - プライマリアクションと重要なUI要素に使用"
         category: "color"
         type: "primary"
         deprecated: false
   ```

2. **トークンドキュメントを自動生成:**
   - トークンカタログウェブサイト
   - Figmaプラグイン統合
   - Storybookアドオン

3. **使用例を追加:**
   ```yaml
   component:
     button:
       primary:
         background:
           default:
             value: "{color.primary.500}"
             comment: "プライマリボタンの背景"
             examples:
               css: "background-color: var(--component-button-primary-background-default);"
               js: "tokens.component.button.primary.background.default"
   ```

---

## 7. リファクタリング戦略

### 7.1 提案アプローチ

現状を考慮し、以下の優先順位で**段階的な、コンポーネント別リファクタリングアプローチ**を推奨します:

### フェーズ1: 基盤 (重要)

**目標:** 構造的問題を修正し、一貫性を確立

**タスク:**
1. **ファイル形式の標準化** (1 PR)
   - 全てのセマンティックJSONをYAMLに変換
   - ビルド設定を更新
   - 出力の整合性を検証

2. **欠落しているベーストークンの修正** (1 PR)
   - gray.25、gray.750、gray.950を追加
   - 欠落しているボーダースタイルを追加
   - 欠落しているアニメーショントークンを追加

3. **トークン参照の標準化** (1 PR)
   - 参照から全ての`.value`サフィックスを削除
   - 全てのトークン参照を検証
   - 壊れた参照を修正

4. **テーマ構造の更新** (1 PR)
   - ダークモードのシャドウを追加
   - ダークモードのボーダーを追加
   - 立体サーフェスを追加

### フェーズ2: セマンティック層の強化 (高優先度)

**目標:** セマンティックトークン構造の完成と標準化

**タスク (各1 PR):**
1. **セマンティックカラー**
   - 冗長なエイリアスを削除
   - アクションカラーを追加
   - フィードバックカラーを追加

2. **セマンティックタイポグラフィ**
   - レスポンシブトークンを追加
   - 構造を標準化
   - 欠落しているプロパティを追加

3. **サーフェストークン**
   - グラスモーフィズムトークンを追加
   - バックドロップフィルターを追加
   - 立体を標準化

4. **状態トークン**
   - focus-visibleを追加
   - pressed状態を追加
   - ローディングアニメーションを追加

5. **レイアウトトークン**
   - セーフエリアインセットを追加
   - flex gapトークンを追加
   - レスポンシブ命名を整合

6. **インタラクショントークン**
   - 完全なアニメーションを追加
   - スクロール動作を追加
   - user selectを追加

### フェーズ3: コンポーネントトークン (中優先度)

**目標:** 全てのコンポーネントトークン定義を完成

**タスク (コンポーネントごとに1 PR):**
1. **ボタンコンポーネント** - サイズ、フォーカス状態、ローディングを追加
2. **入力コンポーネント** - サイズ、複合状態、アイコンを追加
3. **カードコンポーネント** - セクション、シャドウ、フォーカスを追加
4. **モーダルコンポーネント** - ゼロから完成
5. **ツールチップコンポーネント** - ゼロから完成
6. **バッジコンポーネント** - サイズ、アイコンを追加
7. **アラートコンポーネント** - 閉じるボタン、タイトルスタイリングを追加
8. **テーブルコンポーネント** - セルパディング、ソート、状態を追加
9. **ナビゲーションコンポーネント** - サブメニュー、モバイルメニューを追加

### フェーズ4: 高度な機能 (低優先度)

**目標:** 高度なデザインシステム機能を追加

**タスク (各1 PR):**
1. **アクセシビリティトークン** - ハイコントラスト、フォーカスインジケーター
2. **モーションシステム** - 完全なアニメーション定義
3. **マルチブランドサポート** - テーマバリエーション
4. **プラットフォーム出力** - iOS、Android、SCSS
5. **ドキュメント生成** - 自動化されたドキュメント

### 7.2 コンポーネントリファクタリングテンプレート

各コンポーネントリファクタリングPRは、このテンプレートに従ってください:

```markdown
## コンポーネント: [名前]

### 現状
- [既存のトークンをリスト]
- [問題をリスト]

### 提案される変更
- [新しいトークンをリスト]
- [修正をリスト]
- [削除をリスト]

### トークン構造
```yaml
[提案される完全な構造を表示]
```

### 破壊的変更
- [破壊的変更をリスト]
- [移行ガイドを提供]

### テストチェックリスト
- [ ] ライトテーマ検証済み
- [ ] ダークテーマ検証済み
- [ ] 全ての状態テスト済み
- [ ] ドキュメント更新済み
- [ ] 型定義生成済み
- [ ] 壊れた参照なし
```

### 7.3 PR命名規則

一貫したPR命名を使用:
```
[Tokens] カテゴリ - 説明

例:
[Tokens] Base - 欠落しているグレーシェードを追加
[Tokens] Semantic/Colors - 冗長なエイリアスを削除
[Tokens] Component/Button - サイズバリアントとフォーカス状態を追加
[Tokens] Theme/Dark - シャドウオーバーライドを追加
```

### 7.4 レビュー基準

各PRは以下の基準を満たす必要があります:

**必須:**
- [ ] 壊れたトークン参照なし
- [ ] 全ての新しいトークンが文書化
- [ ] 型定義が正常に生成
- [ ] ビルドがエラーなしで通過
- [ ] 後方互換性あり OR 移行ガイド提供

**推奨:**
- [ ] 使用例提供
- [ ] 関連ドキュメント更新
- [ ] Figmaライブラリ更新
- [ ] Storybookサンプル追加

---

## 8. 優先度マトリックス

### 高優先度 (最初に対処)

1. **欠落しているベーストークンの修正** - 他の作業をブロック
2. **ファイル形式の標準化** - 混乱を軽減
3. **モーダルトークンの完成** - 最も不完全なコンポーネント
4. **ツールチップトークンの完成** - 最も不完全なコンポーネント
5. **ダークモードシャドウの追加** - 視覚品質の問題

### 中優先度 (次に対処)

6. **セマンティックカラークリーンアップ** - 明確性の向上
7. **ボタンコンポーネント強化** - 最も使用されるコンポーネント
8. **入力コンポーネント強化** - 最も使用されるコンポーネント
9. **レスポンシブタイポグラフィの追加** - 一般的なニーズ
10. **テーマ構造の強化** - より良いダークモード

### 低優先度 (あると良い)

11. **アクセシビリティトークンの追加** - 段階的な改善
12. **プラットフォーム出力** - より広いエコシステムサポート
13. **モーションシステム** - 高度なインタラクション
14. **ドキュメント生成** - 開発者体験
15. **マルチブランドサポート** - 将来のスケーラビリティ

---

## 9. 見積もり工数

### フェーズ別の内訳

**フェーズ1: 基盤**
- 4 PRs × 2-4時間 = 8-16時間
- **合計: 約12時間**

**フェーズ2: セマンティック層**
- 6 PRs × 3-6時間 = 18-36時間
- **合計: 約27時間**

**フェーズ3: コンポーネントトークン**
- 9 PRs × 4-8時間 = 36-72時間
- **合計: 約54時間**

**フェーズ4: 高度な機能**
- 5 PRs × 6-12時間 = 30-60時間
- **合計: 約45時間**

**総計: 約138時間** (1日8時間で17-18営業日)

### 現実的なタイムライン

- **フェーズ1:** 2週間
- **フェーズ2:** 3-4週間
- **フェーズ3:** 6-7週間
- **フェーズ4:** 5-6週間

**プロジェクト総期間: 16-19週間** (4-5ヶ月)

---

## 10. 次のステップ

### 即座のアクション (今週)

1. **このレポートをチームでレビュー**
2. **ビジネスニーズに基づいてフェーズの優先順位付け**
3. **各コンポーネントの追跡イシューを作成**
4. **トークン変更用のPRテンプレートを設定**
5. **トークンPRのレビュープロセスを確立**

### 推奨される開始点

**フェーズ1、タスク2: 欠落しているベーストークンの修正**から始める

これは:
- 低リスク
- 高インパクト
- 他の作業のブロックを解除
- チームにとって良い練習

**最初のPRは:**
```
[Tokens] Base/Colors - 欠落しているグレーシェードを追加

以下のベースカラートークンを追加:
- color.gray.25
- color.gray.750
- color.gray.950

これらは現在aliases.jsonで参照されているが定義されておらず、
ビルドで壊れた参照を引き起こしている。
```

---

## 11. 成功指標

改善を測定するために以下の指標を追跡:

### 品質指標
- トークン参照エラー: **目標: 0**
- ドキュメントカバレッジ: **目標: 100%**
- コンポーネントトークン完全性: **目標: 95%+**
- テーマカバレッジ: **目標: 視覚的プロパティの100%**

### 一貫性指標
- ファイル形式の一貫性: **目標: 100% YAML**
- 命名規則の準拠: **目標: 100%**
- トークン構造深度の一貫性: **目標: 最大5レベル**

### 使いやすさ指標
- トークンを見つけるまでの時間: **目標: <30秒**
- トークン誤用インシデント: **目標: 月<5件**
- PRレビュー時間: **目標: <24時間**

### 採用指標
- トークンを使用するコンポーネント: **目標: 100%**
- コンポーネント内のハードコード値: **目標: 0**
- Figma同期精度: **目標: 99%+**

---

## 12. 結論

Hidearea Design Systemトークンパッケージは、優れたアーキテクチャ決定と最新のベストプラクティスを示しています。二層CSS変数システムは特に印象的で、Shadow DOM要件への深い理解を示しています。

ただし、改善の重要な機会があります:

1. **完全性:** 多くのコンポーネントトークンが不完全または完全に欠落
2. **一貫性:** 混在したファイル形式と命名パターンが混乱を生む
3. **ドキュメント:** 限定的なインラインドキュメントと生成されたドキュメントなし
4. **保守性:** 一部の構造的決定が更新を困難にする

上記で概説した段階的リファクタリングアプローチに従うことで、トークンシステムは組織のニーズに合わせてスケールする最高クラスのデザインシステム基盤に進化できます。

見積もられた4-5ヶ月のタイムラインは、徹底的で品質重視の改善プロセスにとって現実的です。ただし、高優先度項目は最初の2-4週間で対処でき、即座の影響を達成できます。

---

## 付録A: トークン監査サマリー

### カテゴリ別総トークン数

| カテゴリ | ベース | セマンティック | コンポーネント | テーマ | 合計 |
|----------|------|----------|-----------|-------|-------|
| Colors | 109 | 70 | 95 | 66 | 340 |
| Typography | 41 | 38 | 0 | 0 | 79 |
| Spacing | 37 | 16 | 0 | 0 | 53 |
| Borders | 11 | 0 | 0 | 0 | 11 |
| Shadows | 8 | 12 | 0 | 0 | 20 |
| Animation | 9 | 15 | 0 | 0 | 24 |
| Layout | 0 | 19 | 0 | 0 | 19 |
| States | 0 | 20 | 0 | 0 | 20 |
| **合計** | **215** | **190** | **95** | **66** | **566** |

### コンポーネント別完全性スコア

| コンポーネント | トークン数 | 期待値 | 完全性 |
|-----------|--------|----------|--------------|
| Button | 24 | 60 | 40% |
| Input | 12 | 50 | 24% |
| Card | 6 | 40 | 15% |
| Badge | 12 | 30 | 40% |
| Alert | 16 | 35 | 46% |
| Table | 7 | 50 | 14% |
| Navigation | 6 | 45 | 13% |
| Modal | 3 | 60 | 5% |
| Tooltip | 2 | 30 | 7% |
| **平均** | | | **22%** |

### ファイル形式の分布

- YAML: 9ファイル (50%)
- JSON: 9ファイル (50%)

**推奨:** 100% YAMLに標準化

---

## 付録B: 業界標準との比較

### Material Design 3

- **トークン数:** 約800
- **コンポーネントカバレッジ:** 28コンポーネント
- **完全性:** 約85%
- **プラットフォーム:** Web、Android、iOS、Flutter

### Polaris (Shopify)

- **トークン数:** 約600
- **コンポーネントカバレッジ:** 45コンポーネント
- **完全性:** 約90%
- **プラットフォーム:** Web、React Native、iOS

### Hidearea Design (現在)

- **トークン数:** 約566
- **コンポーネントカバレッジ:** 9コンポーネント
- **完全性:** 約22%
- **プラットフォーム:** Web (CSS、JS、TS)

**ギャップ分析:**
Hideareaは強力な基礎トークンを持っていますが、業界標準に合わせるには3-4倍のコンポーネントトークンが必要です。

---

**レポート終了**

*次: チームでレビューし、実装計画を作成*
